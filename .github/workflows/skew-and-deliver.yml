---

name: Skew and Deliver

on: push

jobs:
  query-ppa:
    runs-on: ubuntu-latest
    outputs:
      build-records: ${{ steps.query.outputs.build-records }}
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - id: query
        uses: ./.github/actions/ppa-build-records-action
        with:
          ppa-name: "32"
          
  build-images:
    runs-on: ubuntu-latest
    needs:
      - query-ppa
    strategy:
      matrix:
        include: ${{ fromJson(needs.query-ppa.outputs.build-records) }}
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - id: build-tag-set
        run: echo "::set-output name::tags::${{matrix.major}}.${{matrix.minor}}.${{matrix.date}}"
